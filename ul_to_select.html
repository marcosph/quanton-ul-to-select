<!DOCTYPE html>
<html>
    <head>
        <title>jQuery Piu/Meno Text</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="favicon.ico" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <style>
            div.ul-selector {
                width: auto;
                margin-top: 1rem;
                border: 1px solid #ccc;
                background-image: url("./down-arrow-black.png");
                background-size: 16px 16px;
                background-repeat: no-repeat;
                background-attachment: scroll;
                background-position: calc(100% - 8px) 8px;
                background-color: transparent;
                cursor: pointer;
                line-height: 2rem;
                font-family: sans-serif;
            }
            div.ul-selector-search {
                border-right: 1px solid #ccc;
                border-left: 1px solid #ccc;
            }
            div.ul-selector-search input {
                width: calc(100% - 0.8rem - 2px);
                padding: 0.2rem;
                margin: 0.2rem;
                border: 1px solid #ccc;
                background-image: url("./search.png");
                background-size: 16px 16px;
                background-repeat: no-repeat;
                background-attachment: scroll;
                background-position: calc(100% - 8px) 8px;
                background-color: transparent;
                line-height: 1.6rem;
                font-family: sans-serif;
                font-size: 1rem;
            }
            div.ul-selector a {
                margin-left: 8px;
                padding-left: 8px;
                margin-right: 8px;
                display: block;
                color: #000;
                text-decoration:none;
            }
            ul.ul-select { 
                width: auto;
                margin: 0 auto auto auto;
                padding: 0px;
                border-top: none;
                border-bottom: 1px solid #ccc;
                border-right: 1px solid #ccc;
                border-left: 1px solid #ccc;
                list-style:none;
                cursor: pointer;
                line-height: 2rem;
                font-family: sans-serif;
                max-height: 300px;
                overflow-x: hidden;
                overflow-y: auto;
            }
            ul.ul-select li.hover {
                background-color: #666;
            }
            ul.ul-select li.hover a {
                color: #fff;
            }
            ul.ul-select li a {
                margin-left: 8px;
                padding-left: 8px;
                margin-right: 8px;
                display: block;
                color: #888;
                text-decoration:none;
            }
        </style>
    </head>
    <body>
        <h2>EUROPE States</h2>
        <ul id="eu">
            <li><a href="#BE">Belgium</a></li>
            <li><a href="#EL">Greece</a></li>
            <li><a href="#LT">Lithuania</a></li>
            <li><a href="#PT">Portugal</a></li>
            <li><a href="#BG">Bulgaria</a></li>
            <li><a href="#ES">Spain</a></li>
            <li><a href="#LU">Luxembourg</a></li>
            <li><a href="#RO">Romania</a></li>
            <li><a href="#CZ">Czech Republic</a></li>
            <li class="active"><a href="#FR">France</a></li>
            <li><a href="#HU">Hungary</a></li>
            <li><a href="#SI">Slovenia</a></li>
            <li><a href="#DK">Denmark</a></li>
            <li><a href="#HR">Croatia</a></li>
            <li><a href="#MT">Malta</a></li>
            <li><a href="#SK">Slovakia</a></li>
            <li><a href="#DE">Germany</a></li>
            <li><a href="#IT">Italy</a></li>
            <li><a href="#NL">Netherlands</a></li>
            <li><a href="#FI">Finland</a></li>
            <li><a href="#EE">Estonia</a></li>
            <li><a href="#CY">Cyprus</a></li>
            <li><a href="#AT">Austria</a></li>
            <li><a href="#SE">Sweden</a></li>
            <li><a href="#IE">Ireland</a></li>
            <li><a href="#LV">Latvia</a></li>
            <li><a href="#PL">Poland</a></li>
            <li><a href="#UK">United Kingdom</a></li>
        </ul>
        <h2>USA States</h2>
        <ul id="usa">
            <li><a href="#AL">Alabama</a></li>
            <li><a href="#AK">Alaska</a></li>
            <li><a href="#AZ">Arizona</a></li>
            <li><a href="#AR">Arkansas</a></li>
            <li><a href="#CA">California</a></li>
            <li><a href="#CO">Colorado</a></li>
            <li><a href="#CT">Connecticut</a></li>
            <li><a href="#DE">Delaware</a></li>
            <li><a href="#FL">Florida</a></li>
            <li><a href="#GA">Georgia</a></li>
            <li><a href="#HI">Hawaii</a></li>
            <li><a href="#ID">Idaho</a></li>
            <li><a href="#IL">Illinois</a></li>
            <li><a href="#IN">Indiana</a></li>
            <li><a href="#IA">Iowa</a></li>
            <li><a href="#KS">Kansas</a></li>
            <li><a href="#KY">Kentucky</a></li>
            <li><a href="#LA">Louisiana</a></li>
            <li><a href="#ME">Maine</a></li>
            <li><a href="#MD">Maryland</a></li>
            <li><a href="#MA">Massachusetts</a></li>
            <li><a href="#MI">Michigan</a></li>
            <li><a href="#MN">Minnesota</a></li>
            <li><a href="#MS">Mississippi</a></li>
            <li><a href="#MO">Missouri</a></li>
            <li><a href="#MT">Montana</a></li>
            <li><a href="#NE">Nebraska</a></li>
            <li><a href="#NV">Nevada</a></li>
            <li><a href="#NH">New Hampshire</a></li>
            <li><a href="#NJ">New Jersey</a></li>
            <li><a href="#NM">New Mexico</a></li>
            <li><a href="#NY">New York</a></li>
            <li><a href="#NC">North Carolina</a></li>
            <li><a href="#ND">North Dakota</a></li>
            <li><a href="#OH">Ohio</a></li>
            <li><a href="#OK">Oklahoma</a></li>
            <li><a href="#OR">Oregon</a></li>
            <li><a href="#PA">Pennsylvania</a></li>
            <li><a href="#RI">Rhode Island</a></li>
            <li><a href="#SC">South Carolina</a></li>
            <li><a href="#SD">South Dakota</a></li>
            <li><a href="#TN">Tennessee</a></li>
            <li><a href="#TX">Texas</a></li>
            <li><a href="#UT">Utah</a></li>
            <li><a href="#VT">Vermont</a></li>
            <li><a href="#VA">Virginia</a></li>
            <li><a href="#WA">Washington</a></li>
            <li><a href="#WV">West Virginia</a></li>
            <li><a href="#WI">Wisconsin</a></li>
            <li><a href="#WY">Wyoming</a></li>
        </ul>
        <script type="text/javascript">
            var ulToSelect = function(element, edgeWidth) {
                var $currentId = undefined;
                var $currentLi = 0;
                // helpers start
                var addUlSelector = function(ulElement, liElement){
                    var $div = $(document.createElement('div')).attr({
                        "class": "ul-selector",
                        "id": ulElement.attr("id")
                    }).append($(document.createElement('a')).attr({
                        "href": "#"
                    }).text(liElement.find("a").text()));
                    ulElement.before($div);
                };
                var addUlSearch = function(ulElement){
                    var $divSearch = $(document.createElement('div')).attr({
                        "class": "ul-selector-search",
                        "id": ulElement.attr("id")
                    }).append($(document.createElement('input')).attr({
                        "type": "text"
                    }));
                    ulElement.before($divSearch);
                };
                var showHideLis = function (text) {
                    element.find("li").each(function(index, element) {
                        $(element).show();
                    });
                    element.find("li").each(function(index, element) {
                        if(!($(element).data("text").toLowerCase()).includes(text.toLowerCase())) {
                            $(element).hide();
                        }
                    });
                };
                var replaceActiveElement = function (li) {
                    // remove active and hover classes on ul lis
                    element.find("li.active").removeClass("active").removeClass("hover");
                    // add active and hover class on current li
                    li.addClass("active");
                    li.addClass("hover");
                    // set selector div text to current a text
                    var $activeText = li.find("a").text();
                    $("div.ul-selector#" + $currentId + "> a").text($activeText);
                    // close the ul
                    close();
                };
                var replaceHover = function (li) {
                    element.find("li").removeClass("hover");
                    li.addClass("hover");
                };
                // helpers end
                var adSelect = function() {
                    element.addClass("ul-select");
                    // hide ul
                    element.hide();
                    // mark active li
                    var $activeLi = element.find("li.active");
                    if($activeLi.length <= 0) {
                        // if active li doesn't exist set first li active
                        $activeLi = element.find("li:first");
                        if($activeLi.length > 0) {
                            $activeLi.attr({
                                "class": "active"
                            });
                        }
                    }
                    // add div for selector
                    if($activeLi.length > 0) {
                        addUlSelector(element, $activeLi);
                    }
                    // add div for search
                    if(element.hasClass("ul-select")) {
                        addUlSearch(element);
                    }
                };
                var close = function() {
                    // only if it has the class ul-selec meaning the converter is active
                    if($("ul#" + $currentId).hasClass("ul-select")) {
                        // hide ul
                        $("ul#" + $currentId).hide();
                        // empty input value
                        $("div.ul-selector-search#" + $currentId).find("input").val("");
                        // hide div search
                        $("div.ul-selector-search#" + $currentId).hide();
                        // for all lis
                        $("ul#" + $currentId).find("li").each(function(){
                            // show all hidden lis from search
                            $(this).show();
                            // add hover class to active element and clear hover
                            $(this).removeClass("hover");
                            if($(this).hasClass("active")) {
                                $(this).addClass("hover");
                            }
                        });
                    }
                };
                var sentinel = function() {
                    // on div selector click
                    $("div.ul-selector#" + $currentId).click(function(event){
                        event.preventDefault();
                        // if ul not visible
                        if(!($("ul#" + $currentId).is(":visible"))) {
                            // show ul
                            $("ul#" + $currentId).show();
                            // show div search
                            $("div.ul-selector-search#" + $currentId).show();
                        } else {
                            close();
                        }
                    });
                    // on li click
                    $(element).find("li").click(function(event){
                        // replace active element
                        replaceActiveElement($(this));
                    });
                    // on hover remove hover class on all lis and then add to current li
                    element.find("li").hover(function(){
                        replaceHover($(this));
                    });
                };
                var reconnaissance = function() {
                    $(document).click(function(event) {
                        // wait for click outside of active elements and close the uls
                        if(!$(event.target).is("div.ul-selector#" + $currentId + "> a") && !$(event.target).is("div.ul-selector-search#" + $currentId + "> input")) {
                            close();
                        }
                    });
                };
                var addDataText = function () {
                    // on all lis add data-text
                    element.find("li").each(function(index, element) {
                        $(element).attr({
                            "data-text": $(element).find("a").text()
                        });
                    });
                };
                var search = function () {
                    // on search hide lis that doesn't match
                    var $scrollGap = 0;
                    var $visibleLiGap = 0;
                    $("div.ul-selector-search#" + element.attr("id") + " input").one("click", function () {
                        // calculate scroll gap only once on input click
                        var $firstVisibleLi = element.find("li:visible:eq(0)");
                        var $secondVisibleLi = element.find("li:visible:eq(1)");
                        if($secondVisibleLi.length > 0 && $firstVisibleLi.length > 0) {
                            $scrollGap = $secondVisibleLi.position().top - $firstVisibleLi.position().top;
                        }
                    }).focus(function() {
                        // on input focus scroll to active li
                        var $scrollValue = 0;
                        var $activeLi = element.find("li.active");
                        var $firstLi = element.find("li:visible:eq(0)");
                        if($activeLi.length > 0) {
                            $currentLi = $activeLi.index();
                        } else {
                            $currentLi = 0;
                        }
                        // calculate the gap between the first and visible li so to calculate how to scroll on down up click
                        if($activeLi.length > 0 && $firstLi.length > 0) {
                            $scrollValue = ($activeLi.position().top - $firstLi.position().top);
                            $visibleLiGap = $scrollValue;
                        }
                        $("ul.ul-select").scrollTop($scrollValue);
                    }).keyup(function(event) {
                        if(!(event.which === 40 || event.which === 38)) {
                            // show hide lis that makes match and move hover on current first element of these that make match
                            showHideLis(this.value);
                            // set current li to first visible li
                            $currentLi = 0;
                            var $visibleLi = element.find("li:visible:eq("+$currentLi+")");
                            if($visibleLi.length > 0) {
                                replaceHover($visibleLi);
                            }
                            $visibleLiGap = 0;
                            $("ul.ul-select").scrollTop(0);
                        }
                    }).keydown(function(event) {
                        if(event.which === 40 && $currentLi < (element.find("li:visible").length - 1)) {
                            // on key press down set hover to selected element and scroll on hovered element
                            ++$currentLi;
                            var $visibleLi = element.find("li:visible:eq("+$currentLi+")");
                            if($visibleLi.length > 0) {
                                replaceHover($visibleLi);
                                $visibleLiGap = $visibleLiGap + $scrollGap;
                                $("ul.ul-select").scrollTop($visibleLiGap);
                            }
                        }
                        if(event.which === 38 && $currentLi > 0) {
                            // on key press up set hover to selected element and scroll on hovered element
                            --$currentLi;
                            var $visibleLi = element.find("li:visible:eq("+$currentLi+")");
                            if($visibleLi.length > 0) {
                                replaceHover($visibleLi);
                                $visibleLiGap = $visibleLiGap - $scrollGap;
                                $("ul.ul-select").scrollTop($visibleLiGap);
                            }
                        }
                        if(event.which === 13) {
                            event.preventDefault();
                            // on enter event go to the href of hovered element
                            var $hoveredLi = element.find("li.hover");
                            if($hoveredLi.length > 0) {
                                window.location.href = $hoveredLi.find("a").attr('href');
                                // replace active element
                                replaceActiveElement($hoveredLi);
                            }
                        }
                    });
                };
                if($(window).width() <= edgeWidth) {
                    if(!$(element).hasClass("ul-select")) {
                        $currentId = $(element).attr("id");
                        adSelect();
                        close();
                        sentinel();
                        reconnaissance();
                        addDataText();
                        search();
                    }
                } else if($(element).hasClass("ul-select")) {
                    $(element).removeClass("ul-select");
                    $("div.ul-selector").remove();
                    $("div.ul-selector-search").remove();
                    $(element).show();
                }
            };
            
            $(window).on("load resize", function() {
                ulToSelect($("ul#usa"), 767);
                ulToSelect($("ul#eu"), 767);
            });
        </script>
    </body>
</html>
